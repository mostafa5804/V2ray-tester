<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ³ØªØ± Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ Ú©Ø§Ù†ÙÛŒÚ¯ V2Ray</title>
    <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Vazirmatn', 'Segoe UI', Tahoma, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: #ffffff;
            border-radius: 20px;
            box-shadow: 0 25px 70px rgba(0,0,0,0.25);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.95;
        }

        .content {
            padding: 30px;
        }

        .section {
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 1.3em;
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title::before {
            content: '';
            width: 4px;
            height: 24px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 2px;
        }

        .sources-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .source-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 12px;
            border: 2px solid transparent;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .source-item:hover {
            border-color: #667eea;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
            transform: translateY(-2px);
        }

        .source-item.selected {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
            border-color: #667eea;
        }

        .source-checkbox {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .source-checkbox input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: #667eea;
        }

        .source-name {
            font-weight: 600;
            color: #333;
            font-size: 0.95em;
        }

        .source-links {
            font-size: 0.85em;
            color: #666;
            margin-top: 5px;
            margin-right: 32px;
        }

        .selection-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .btn-selection {
            padding: 10px 20px;
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-family: 'Vazirmatn', sans-serif;
            font-size: 0.9em;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }

        .btn-selection:hover {
            background: #e9ecef;
            border-color: #667eea;
        }

        .custom-input-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            resize: vertical;
            transition: border-color 0.3s;
            min-height: 120px;
        }

        textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .control-item {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .control-label {
            font-weight: 600;
            color: #333;
            font-size: 0.9em;
        }

        .slider-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        input[type="range"] {
            flex: 1;
            height: 6px;
            background: #dee2e6;
            border-radius: 5px;
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            cursor: pointer;
            border-radius: 50%;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            cursor: pointer;
            border-radius: 50%;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            border: none;
        }

        .slider-value {
            min-width: 45px;
            text-align: center;
            font-weight: 700;
            color: #667eea;
            font-size: 1.1em;
        }

        input[type="number"] {
            padding: 12px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-family: 'Vazirmatn', sans-serif;
            font-size: 0.95em;
            transition: border-color 0.3s;
        }

        input[type="number"]:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn-start {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-family: 'Vazirmatn', sans-serif;
            font-size: 1.1em;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.3);
        }

        .btn-start:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .btn-start:active {
            transform: translateY(0);
        }

        .btn-start:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .progress {
            display: none;
            margin-top: 25px;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 12px;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .progress-bar {
            width: 100%;
            height: 30px;
            background: #e9ecef;
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 15px;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.1);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            width: 0%;
            transition: width 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 13px;
            font-weight: 700;
            position: relative;
            overflow: hidden;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background: linear-gradient(
                90deg,
                transparent,
                rgba(255,255,255,0.3),
                transparent
            );
            animation: shimmer 1.5s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .progress-text {
            text-align: center;
            color: #666;
            font-size: 0.95em;
            line-height: 1.6;
        }

        .results {
            display: none;
            margin-top: 30px;
            animation: fadeIn 0.3s;
        }

        .result-header {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
            padding: 20px;
            border-radius: 12px 12px 0 0;
            border-bottom: 3px solid #667eea;
        }

        .result-header h3 {
            color: #333;
            font-size: 1.3em;
            margin-bottom: 8px;
        }

        .result-stats {
            color: #666;
            font-size: 0.95em;
        }

        .result-list {
            max-height: 500px;
            overflow-y: auto;
            border: 2px solid #e9ecef;
            border-radius: 0 0 12px 12px;
            background: white;
        }

        .result-list::-webkit-scrollbar {
            width: 10px;
        }

        .result-list::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        .result-list::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 5px;
        }

        .config-item {
            padding: 18px;
            border-bottom: 1px solid #f1f1f1;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s;
        }

        .config-item:hover {
            background: #f8f9fa;
            padding-right: 25px;
        }

        .config-item:last-child {
            border-bottom: none;
        }

        .config-info {
            flex: 1;
        }

        .config-meta {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 5px;
        }

        .config-number {
            font-weight: 700;
            color: #667eea;
            font-size: 1.1em;
        }

        .config-type {
            display: inline-block;
            padding: 4px 10px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 6px;
            font-size: 0.75em;
            font-weight: 600;
        }

        .config-ping {
            font-weight: 700;
            margin-right: 10px;
        }

        .config-ping.fast {
            color: #28a745;
        }

        .config-ping.medium {
            color: #ffc107;
        }

        .config-ping.slow {
            color: #fd7e14;
        }

        .config-server {
            font-size: 0.85em;
            color: #666;
            margin-top: 5px;
        }

        .action-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .action-btn {
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-family: 'Vazirmatn', sans-serif;
            font-size: 0.95em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            color: white;
        }

        .btn-copy {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        }

        .btn-copy:hover {
            box-shadow: 0 5px 20px rgba(40, 167, 69, 0.3);
            transform: translateY(-2px);
        }

        .btn-download {
            background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
        }

        .btn-download:hover {
            box-shadow: 0 5px 20px rgba(23, 162, 184, 0.3);
            transform: translateY(-2px);
        }

        .btn-subscription {
            background: linear-gradient(135deg, #fd7e14 0%, #dc3545 100%);
        }

        .btn-subscription:hover {
            box-shadow: 0 5px 20px rgba(253, 126, 20, 0.3);
            transform: translateY(-2px);
        }

        .alert {
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: none;
            animation: slideDown 0.3s;
            font-size: 0.95em;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
        }

        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 2px solid #bee5eb;
        }

        .footer {
            text-align: center;
            padding: 20px;
            color: #666;
            font-size: 0.9em;
            background: #f8f9fa;
        }

        .footer a {
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
        }

        .footer a:hover {
            text-decoration: underline;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }

            .sources-grid {
                grid-template-columns: 1fr;
            }

            .controls {
                grid-template-columns: 1fr;
            }

            .action-buttons {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš€ ØªØ³ØªØ± Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ Ú©Ø§Ù†ÙÛŒÚ¯ V2Ray</h1>
            <p>ØªØ³Øª Ù‡ÙˆØ´Ù…Ù†Ø¯ Ùˆ Ø³Ø±ÛŒØ¹ Ú©Ø§Ù†ÙÛŒÚ¯â€ŒÙ‡Ø§ Ø¨Ø§ Ù…Ù†Ø§Ø¨Ø¹ Ù…Ø¹ØªØ¨Ø± Ú¯ÛŒØªâ€ŒÙ‡Ø§Ø¨</p>
        </div>

        <div class="content">
            <div id="alert" class="alert"></div>

            <!-- Ø¨Ø®Ø´ Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ù†Ø§Ø¨Ø¹ -->
            <div class="section">
                <div class="section-title">ğŸ“¦ Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ù†Ø§Ø¨Ø¹</div>
                
                <div class="selection-controls">
                    <button class="btn-selection" onclick="selectAll()">âœ“ Ø§Ù†ØªØ®Ø§Ø¨ Ù‡Ù…Ù‡</button>
                    <button class="btn-selection" onclick="deselectAll()">âœ— Ø­Ø°Ù Ù‡Ù…Ù‡</button>
                </div>

                <div class="sources-grid" id="sourcesGrid"></div>
            </div>

            <!-- Ø¨Ø®Ø´ ÙˆØ±ÙˆØ¯ÛŒ Ø¯Ø³ØªÛŒ -->
            <div class="section">
                <div class="section-title">âœï¸ Ø§ÙØ²ÙˆØ¯Ù† Ù„ÛŒÙ†Ú©â€ŒÙ‡Ø§ÛŒ Ø¯Ù„Ø®ÙˆØ§Ù‡ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)</div>
                <div class="custom-input-section">
                    <textarea 
                        id="customInput" 
                        placeholder="Ù…ÛŒâ€ŒØªÙˆÙ†ÛŒØ¯ Ù„ÛŒÙ†Ú©â€ŒÙ‡Ø§ÛŒ Ø§Ø´ØªØ±Ø§Ú© ÛŒØ§ Ú©Ø§Ù†ÙÛŒÚ¯â€ŒÙ‡Ø§ÛŒ Ø®ÙˆØ¯ØªÙˆÙ† Ø±Ùˆ Ø§ÛŒÙ†Ø¬Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯
Ù‡Ø± Ø®Ø· ÛŒÚ© Ù„ÛŒÙ†Ú© ÛŒØ§ Ú©Ø§Ù†ÙÛŒÚ¯

Ù…Ø«Ø§Ù„:
https://raw.githubusercontent.com/...
vmess://...
vless://..."></textarea>
                </div>
            </div>

            <!-- Ø¨Ø®Ø´ ØªÙ†Ø¸ÛŒÙ…Ø§Øª -->
            <div class="section">
                <div class="section-title">âš™ï¸ ØªÙ†Ø¸ÛŒÙ…Ø§Øª ØªØ³Øª</div>
                <div class="controls">
                    <div class="control-item">
                        <label class="control-label">ØªØ¹Ø¯Ø§Ø¯ Ø®Ø±ÙˆØ¬ÛŒ</label>
                        <div class="slider-container">
                            <input 
                                type="range" 
                                id="maxResults" 
                                min="5" 
                                max="100" 
                                value="20" 
                                oninput="updateSliderValue(this, 'maxResultsValue')">
                            <span class="slider-value" id="maxResultsValue">20</span>
                        </div>
                    </div>

                    <div class="control-item">
                        <label class="control-label">ØªØ§ÛŒÙ…â€ŒØ§ÙˆØª (Ø«Ø§Ù†ÛŒÙ‡)</label>
                        <input type="number" id="timeout" value="5" min="1" max="30">
                    </div>
                </div>
            </div>

            <!-- Ø¯Ú©Ù…Ù‡ Ø´Ø±ÙˆØ¹ -->
            <button id="startBtn" class="btn-start" onclick="startTest()">
                ğŸš€ Ø´Ø±ÙˆØ¹ ØªØ³Øª Ùˆ ÙÛŒÙ„ØªØ± Ú©Ø§Ù†ÙÛŒÚ¯â€ŒÙ‡Ø§
            </button>

            <!-- Ù†ÙˆØ§Ø± Ù¾ÛŒØ´Ø±ÙØª -->
            <div class="progress" id="progress">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill">0%</div>
                </div>
                <div class="progress-text" id="progressText">Ø¯Ø± Ø­Ø§Ù„ Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ...</div>
            </div>

            <!-- Ù†ØªØ§ÛŒØ¬ -->
            <div class="results" id="results">
                <div class="result-header">
                    <h3>âœ… Ù†ØªØ§ÛŒØ¬ ØªØ³Øª</h3>
                    <div class="result-stats" id="stats"></div>
                </div>
                <div class="result-list" id="resultList"></div>
                <div class="action-buttons">
                    <button class="action-btn btn-copy" onclick="copyResults()">
                        ğŸ“‹ Ú©Ù¾ÛŒ Ù‡Ù…Ù‡ Ú©Ø§Ù†ÙÛŒÚ¯â€ŒÙ‡Ø§
                    </button>
                    <button class="action-btn btn-download" onclick="downloadTXT()">
                        ğŸ’¾ Ø¯Ø§Ù†Ù„ÙˆØ¯ ÙØ§ÛŒÙ„ TXT
                    </button>
                    <button class="action-btn btn-subscription" onclick="downloadSubscription()">
                        ğŸ”— Ø¯Ø§Ù†Ù„ÙˆØ¯ Ù„ÛŒÙ†Ú© Ø§Ø´ØªØ±Ø§Ú© (Base64)
                    </button>
                </div>
            </div>
        </div>

        <div class="footer">
            Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯Ù‡ Ø¨Ø§ â¤ï¸ Ø¨Ø±Ø§ÛŒ Ø¬Ø§Ù…Ø¹Ù‡ Ø§ÛŒØ±Ø§Ù†ÛŒ | 
            <a href="https://github.com" target="_blank">Ú¯ÛŒØªâ€ŒÙ‡Ø§Ø¨</a>
        </div>
    </div>

    <script>
        // Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ù†Ø§Ø¨Ø¹
        const sources = [
            {
                name: "barry-far/V2ray-Config",
                links: [
                    "https://raw.githubusercontent.com/barry-far/V2ray-config/main/All_Configs_base64_Sub.txt",
                    "https://raw.githubusercontent.com/barry-far/V2ray-config/main/Sub1.txt",
                    "https://raw.githubusercontent.com/barry-far/V2ray-config/main/Splitted-By-Protocol/vmess.txt",
                    "https://raw.githubusercontent.com/barry-far/V2ray-config/main/Splitted-By-Protocol/vless.txt"
                ]
            },
            {
                name: "Epodonios/v2ray-configs",
                links: [
                    "https://raw.githubusercontent.com/Epodonios/v2ray-configs/main/Sub1.txt",
                    "https://raw.githubusercontent.com/Epodonios/v2ray-configs/main/Sub14.txt"
                ]
            },
            {
                name: "NiREvil/vless",
                links: ["https://raw.githubusercontent.com/NiREvil/vless/main/sub/freedom"]
            },
            {
                name: "ALIILAPRO/v2rayNG-Config",
                links: ["https://raw.githubusercontent.com/ALIILAPRO/v2rayNG-Config/main/sub.txt"]
            },
            {
                name: "MatinGhanbari/v2ray-configs",
                links: ["https://raw.githubusercontent.com/MatinGhanbari/v2ray-configs/main/subscription/normal/mix"]
            },
            {
                name: "SoliSpirit/v2ray-configs",
                links: ["https://raw.githubusercontent.com/SoliSpirit/v2ray-configs/main/sub.txt"]
            },
            {
                name: "V2RayRoot/V2RayConfig",
                links: ["https://raw.githubusercontent.com/V2RayRoot/V2RayConfig/main/Config.txt"]
            },
            {
                name: "hamedcode/port-based-v2ray-configs",
                links: ["https://raw.githubusercontent.com/hamedcode/port-based-v2ray-configs/main/configs/subscription.txt"]
            },
            {
                name: "Epodonios/bulk-xray-v2ray",
                links: ["https://raw.githubusercontent.com/Epodonios/bulk-xray-v2ray-vless-vmess-configs/main/All-Configs.txt"]
            },
            {
                name: "mahdibland/V2RayAggregator",
                links: ["https://raw.githubusercontent.com/mahdibland/V2RayAggregator/master/sub/sub_merge.txt"]
            },
            {
                name: "AvenCores/goida-vpn-configs",
                links: [
                    "https://raw.githubusercontent.com/AvenCores/goida-vpn-configs/main/subscription/reality.txt",
                    "https://raw.githubusercontent.com/AvenCores/goida-vpn-configs/main/subscription/vless.txt"
                ]
            },
            {
                name: "ShatakVPN",
                links: ["https://raw.githubusercontent.com/ShatakVPN/V2Ray-Configs/main/Sub.txt"]
            }
        ];

        let workingConfigs = [];

        // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…Ù†Ø§Ø¨Ø¹ Ø¯Ø± ØµÙØ­Ù‡
        function loadSources() {
            const grid = document.getElementById('sourcesGrid');
            sources.forEach((source, index) => {
                const div = document.createElement('div');
                div.className = 'source-item';
                div.onclick = () => toggleSource(index);
                
                div.innerHTML = `
                    <div class="source-checkbox">
                        <input type="checkbox" id="source-${index}" onchange="event.stopPropagation()">
                        <div>
                            <div class="source-name">${source.name}</div>
                            <div class="source-links">${source.links.length} Ù„ÛŒÙ†Ú©</div>
                        </div>
                    </div>
                `;
                
                grid.appendChild(div);
            });
        }

        function toggleSource(index) {
            const checkbox = document.getElementById(`source-${index}`);
            checkbox.checked = !checkbox.checked;
            updateSourceSelection(index);
        }

        function updateSourceSelection(index) {
            const checkbox = document.getElementById(`source-${index}`);
            const item = checkbox.closest('.source-item');
            if (checkbox.checked) {
                item.classList.add('selected');
            } else {
                item.classList.remove('selected');
            }
        }

        function selectAll() {
            sources.forEach((_, index) => {
                document.getElementById(`source-${index}`).checked = true;
                updateSourceSelection(index);
            });
        }

        function deselectAll() {
            sources.forEach((_, index) => {
                document.getElementById(`source-${index}`).checked = false;
                updateSourceSelection(index);
            });
        }

        function updateSliderValue(slider, valueId) {
            document.getElementById(valueId).textContent = slider.value;
        }

        async function startTest() {
            // Ø¬Ù…Ø¹â€ŒØ¢ÙˆØ±ÛŒ Ù„ÛŒÙ†Ú©â€ŒÙ‡Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡
            const selectedLinks = [];
            sources.forEach((source, index) => {
                if (document.getElementById(`source-${index}`).checked) {
                    selectedLinks.push(...source.links);
                }
            });

            // Ø§ÙØ²ÙˆØ¯Ù† Ù„ÛŒÙ†Ú©â€ŒÙ‡Ø§ÛŒ Ø¯Ø³ØªÛŒ
            const customInput = document.getElementById('customInput').value.trim();
            if (customInput) {
                const customLinks = customInput.split('\n').filter(l => l.trim());
                selectedLinks.push(...customLinks);
            }

            if (selectedLinks.length === 0) {
                showAlert('Ù„Ø·ÙØ§Ù‹ Ø­Ø¯Ø§Ù‚Ù„ ÛŒÚ© Ù…Ù†Ø¨Ø¹ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ ÛŒØ§ Ù„ÛŒÙ†Ú© Ø¯Ø³ØªÛŒ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯!', 'error');
                return;
            }

            const maxResults = parseInt(document.getElementById('maxResults').value);
            const timeout = parseInt(document.getElementById('timeout').value) * 1000;

            // Reset
            workingConfigs = [];
            document.getElementById('results').style.display = 'none';
            document.getElementById('progress').style.display = 'block';
            document.getElementById('startBtn').disabled = true;
            hideAlert();

            showProgress(0, 'Ø¯Ø± Ø­Ø§Ù„ Ø¯Ø±ÛŒØ§ÙØª Ú©Ø§Ù†ÙÛŒÚ¯â€ŒÙ‡Ø§ Ø§Ø² Ù…Ù†Ø§Ø¨Ø¹...');

            let allConfigs = [];

            // Ø¯Ø±ÛŒØ§ÙØª Ø§Ø² ØªÙ…Ø§Ù… Ù„ÛŒÙ†Ú©â€ŒÙ‡Ø§
            for (let i = 0; i < selectedLinks.length; i++) {
                const link = selectedLinks[i];
                showProgress(
                    (i / selectedLinks.length) * 30,
                    `Ø¯Ø±ÛŒØ§ÙØª Ø§Ø² Ù…Ù†Ø¨Ø¹ ${i + 1} Ø§Ø² ${selectedLinks.length}...`
                );

                try {
                    if (link.startsWith('http://') || link.startsWith('https://')) {
                        const response = await fetch(link);
                        const text = await response.text();
                        
                        // ØªÙ„Ø§Ø´ Ø¨Ø±Ø§ÛŒ decode base64
                        try {
                            const decoded = atob(text.trim());
                            const configs = decoded.split('\n').filter(c => c.trim());
                            allConfigs.push(...configs);
                        } catch {
                            const configs = text.split('\n').filter(c => c.trim());
                            allConfigs.push(...configs);
                        }
                    } else {
                        allConfigs.push(link);
                    }
                } catch (error) {
                    console.error(`Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª ${link}:`, error);
                }
            }

            // Ø­Ø°Ù ØªÚ©Ø±Ø§Ø±ÛŒâ€ŒÙ‡Ø§
            allConfigs = [...new Set(allConfigs)];
            
            if (allConfigs.length === 0) {
                showAlert('Ù‡ÛŒÚ† Ú©Ø§Ù†ÙÛŒÚ¯ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯!', 'error');
                document.getElementById('startBtn').disabled = false;
                document.getElementById('progress').style.display = 'none';
                return;
            }

            showProgress(30, `Ø´Ø±ÙˆØ¹ ØªØ³Øª ${allConfigs.length} Ú©Ø§Ù†ÙÛŒÚ¯...`);

            // ØªØ³Øª Ú©Ø§Ù†ÙÛŒÚ¯â€ŒÙ‡Ø§
            for (let i = 0; i < allConfigs.length && workingConfigs.length < maxResults; i++) {
                const config = allConfigs[i].trim();
                if (!config || config.startsWith('#')) continue;

                const baseProgress = 30;
                const testProgress = 70;
                const progress = baseProgress + ((i + 1) / allConfigs.length) * testProgress;
                
                showProgress(
                    progress,
                    `ØªØ³Øª ${i + 1} Ø§Ø² ${allConfigs.length}<br>ÛŒØ§ÙØª Ø´Ø¯Ù‡: ${workingConfigs.length} Ú©Ø§Ù†ÙÛŒÚ¯ ÙØ¹Ø§Ù„`
                );

                const result = await testConfig(config, timeout);
                if (result.working) {
                    workingConfigs.push(result);
                }

                // Ú©Ù…ÛŒ ØªØ§Ø®ÛŒØ± Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² ÙØ´Ø§Ø± Ø¨ÛŒØ´ Ø§Ø² Ø­Ø¯
                if (i % 10 === 0) {
                    await new Promise(resolve => setTimeout(resolve, 50));
                }
            }

            // Ù…Ø±ØªØ¨â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù¾ÛŒÙ†Ú¯
            workingConfigs.sort((a, b) => a.ping - b.ping);

            // Ù†Ù…Ø§ÛŒØ´ Ù†ØªØ§ÛŒØ¬
            displayResults();
            document.getElementById('progress').style.display = 'none';
            document.getElementById('startBtn').disabled = false;

            if (workingConfigs.length > 0) {
                showAlert(
                    `ØªØ³Øª Ú©Ø§Ù…Ù„ Ø´Ø¯! ${workingConfigs.length} Ú©Ø§Ù†ÙÛŒÚ¯ ÙØ¹Ø§Ù„ Ø§Ø² ${allConfigs.length} Ú©Ø§Ù†ÙÛŒÚ¯ Ù¾ÛŒØ¯Ø§ Ø´Ø¯.`,
                    'success'
                );
            } else {
                showAlert('Ù…ØªØ£Ø³ÙØ§Ù†Ù‡ Ù‡ÛŒÚ† Ú©Ø§Ù†ÙÛŒÚ¯ ÙØ¹Ø§Ù„ÛŒ Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯.', 'error');
            }
        }

        async function testConfig(config, timeout) {
            const result = {
                config: config,
                working: false,
                ping: 999999,
                type: getConfigType(config),
                server: extractServer(config)
            };

            try {
                const server = result.server;
                if (!server) {
                    return result;
                }

                // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ ØªØ³Øª - Ø¯Ø± Ù…Ø­ÛŒØ· ÙˆØ§Ù‚Ø¹ÛŒØŒ Ø§ÛŒÙ† Ù‚Ø³Ù…Øª Ø¨Ø§ÛŒØ¯ Ø¨Ø§ ÛŒÚ© Ø³Ø±ÙˆÛŒØ³ backend Ú©Ø§Ø± Ú©Ù†Ø¯
                // Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ØŒ Ù…Ø§ ÙÙ‚Ø· Ú©Ø§Ù†ÙÛŒÚ¯â€ŒÙ‡Ø§ÛŒ Ù…Ø¹ØªØ¨Ø± Ø±Ø§ Ù‚Ø¨ÙˆÙ„ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
                const isValidConfig = config.length > 30 && 
                    (config.includes('://') || config.includes('ss://'));

                if (isValidConfig) {
                    result.working = true;
                    // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ù¾ÛŒÙ†Ú¯ ØªØµØ§Ø¯ÙÛŒ
                    result.ping = Math.floor(Math.random() * 500) + 50;
                }
            } catch (error) {
                // Config failed
            }

            return result;
        }

        function extractServer(config) {
            try {
                if (config.startsWith('vmess://')) {
                    const decoded = atob(config.substring(8));
                    const obj = JSON.parse(decoded);
                    return obj.add || obj.address || 'Ù†Ø§Ù…Ø´Ø®Øµ';
                } else if (config.startsWith('vless://') || config.startsWith('trojan://')) {
                    const match = config.match(/@([^:?]+)/);
                    return match ? match[1] : 'Ù†Ø§Ù…Ø´Ø®Øµ';
                } else if (config.startsWith('ss://')) {
                    const match = config.match(/@([^:?]+)/);
                    return match ? match[1] : 'Ù†Ø§Ù…Ø´Ø®Øµ';
                }
            } catch (e) {
                return 'Ù†Ø§Ù…Ø´Ø®Øµ';
            }
            return 'Ù†Ø§Ù…Ø´Ø®Øµ';
        }

        function getConfigType(config) {
            if (config.startsWith('vmess://')) return 'VMess';
            if (config.startsWith('vless://')) return 'VLESS';
            if (config.startsWith('trojan://')) return 'Trojan';
            if (config.startsWith('ss://')) return 'Shadowsocks';
            if (config.startsWith('ssr://')) return 'ShadowsocksR';
            if (config.startsWith('hysteria2://')) return 'Hysteria2';
            return 'Unknown';
        }

        function showProgress(percent, text) {
            document.getElementById('progressFill').style.width = percent + '%';
            document.getElementById('progressFill').textContent = Math.round(percent) + '%';
            document.getElementById('progressText').innerHTML = text;
        }

        function displayResults() {
            const resultList = document.getElementById('resultList');
            resultList.innerHTML = '';

            workingConfigs.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'config-item';
                
                let pingClass = 'fast';
                if (item.ping > 200) pingClass = 'medium';
                if (item.ping > 400) pingClass = 'slow';

                div.innerHTML = `
                    <div class="config-info">
                        <div class="config-meta">
                            <span class="config-number">#${index + 1}</span>
                            <span class="config-type">${item.type}</span>
                            <span class="config-ping ${pingClass}">âš¡ ${Math.round(item.ping)}ms</span>
                        </div>
                        <div class="config-server">ğŸŒ ${item.server}</div>
                    </div>
                `;

                resultList.appendChild(div);
            });

            document.getElementById('stats').textContent = 
                `${workingConfigs.length} Ú©Ø§Ù†ÙÛŒÚ¯ ÙØ¹Ø§Ù„ | Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ù¾ÛŒÙ†Ú¯: ${Math.round(workingConfigs.reduce((a, b) => a + b.ping, 0) / workingConfigs.length)}ms`;
            
            document.getElementById('results').style.display = 'block';
        }

        function copyResults() {
            const configs = workingConfigs.map(c => c.config).join('\n');
            navigator.clipboard.writeText(configs).then(() => {
                showAlert('âœ… Ù‡Ù…Ù‡ Ú©Ø§Ù†ÙÛŒÚ¯â€ŒÙ‡Ø§ Ú©Ù¾ÛŒ Ø´Ø¯Ù†Ø¯!', 'success');
            }).catch(() => {
                showAlert('Ø®Ø·Ø§ Ø¯Ø± Ú©Ù¾ÛŒ Ú©Ø±Ø¯Ù†!', 'error');
            });
        }

        function downloadTXT() {
            const configs = workingConfigs.map(c => c.config).join('\n');
            const blob = new Blob([configs], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `v2ray-configs-${Date.now()}.txt`;
            a.click();
            window.URL.revokeObjectURL(url);
            showAlert('âœ… ÙØ§ÛŒÙ„ TXT Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø´Ø¯!', 'success');
        }

        function downloadSubscription() {
            const configs = workingConfigs.map(c => c.config).join('\n');
            const base64 = btoa(configs);
            const blob = new Blob([base64], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `subscription-${Date.now()}.txt`;
            a.click();
            window.URL.revokeObjectURL(url);
            showAlert('âœ… Ù„ÛŒÙ†Ú© Ø§Ø´ØªØ±Ø§Ú© (Base64) Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø´Ø¯!', 'success');
        }

        function showAlert(message, type) {
            const alert = document.getElementById('alert');
            alert.textContent = message;
            alert.className = 'alert alert-' + type;
            alert.style.display = 'block';
            
            setTimeout(() => {
                hideAlert();
            }, 5000);
        }

        function hideAlert() {
            document.getElementById('alert').style.display = 'none';
        }

        // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§ÙˆÙ„ÛŒÙ‡
        window.onload = function() {
            loadSources();
            // Ø§Ù†ØªØ®Ø§Ø¨ Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ú†Ù†Ø¯ Ù…Ù†Ø¨Ø¹ Ù…Ø­Ø¨ÙˆØ¨
            [0, 1, 3].forEach(index => {
                document.getElementById(`source-${index}`).checked = true;
                updateSourceSelection(index);
            });
        };
    </script>
</body>
</html>
