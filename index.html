<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ³ØªØ± ÙˆØ§Ù‚Ø¹ÛŒ V2Ray</title>
    <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Vazirmatn', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: #ffffff;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .header h1 {
            font-size: 1.5em;
            margin-bottom: 5px;
            font-weight: 700;
        }

        .header p {
            font-size: 0.85em;
            opacity: 0.95;
        }

        .content {
            padding: 20px;
        }

        .section {
            margin-bottom: 20px;
        }

        .section-title {
            font-size: 1.1em;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Ù…Ù†Ø§Ø¨Ø¹ - Ù†Ø³Ø®Ù‡ ÙØ´Ø±Ø¯Ù‡ */
        .sources-compact {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
        }

        .source-group {
            margin-bottom: 10px;
        }

        .source-group-title {
            font-weight: 600;
            color: #667eea;
            margin-bottom: 8px;
            font-size: 0.9em;
        }

        .source-checkboxes {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 8px;
        }

        .source-check {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.85em;
        }

        .source-check input {
            width: 16px;
            height: 16px;
            cursor: pointer;
            accent-color: #667eea;
        }

        .source-check label {
            cursor: pointer;
            user-select: none;
        }

        .quick-actions {
            display: flex;
            gap: 8px;
            margin-top: 10px;
        }

        .quick-btn {
            padding: 6px 12px;
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            font-family: 'Vazirmatn', sans-serif;
            font-size: 0.8em;
            cursor: pointer;
            transition: all 0.2s;
        }

        .quick-btn:hover {
            background: #e9ecef;
            border-color: #667eea;
        }

        /* ÙˆØ±ÙˆØ¯ÛŒ Ø¯Ø³ØªÛŒ */
        textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            resize: vertical;
            min-height: 80px;
            transition: border-color 0.3s;
        }

        textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        /* ØªÙ†Ø¸ÛŒÙ…Ø§Øª */
        .controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .control-item label {
            display: block;
            font-size: 0.85em;
            font-weight: 600;
            margin-bottom: 6px;
            color: #333;
        }

        .slider-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        input[type="range"] {
            flex: 1;
            height: 4px;
            background: #dee2e6;
            border-radius: 3px;
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            background: #667eea;
            cursor: pointer;
            border-radius: 50%;
        }

        input[type="range"]::-moz-range-thumb {
            width: 16px;
            height: 16px;
            background: #667eea;
            cursor: pointer;
            border-radius: 50%;
            border: none;
        }

        .slider-value {
            min-width: 35px;
            text-align: center;
            font-weight: 700;
            color: #667eea;
        }

        input[type="number"] {
            width: 100%;
            padding: 8px;
            border: 2px solid #dee2e6;
            border-radius: 6px;
            font-family: 'Vazirmatn', sans-serif;
            font-size: 0.9em;
        }

        input[type="number"]:focus {
            outline: none;
            border-color: #667eea;
        }

        /* Ø¯Ú©Ù…Ù‡ Ø´Ø±ÙˆØ¹ */
        .btn-start {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-family: 'Vazirmatn', sans-serif;
            font-size: 1em;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-start:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-start:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        /* Ù¾ÛŒØ´Ø±ÙØª */
        .progress {
            display: none;
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .progress-bar {
            width: 100%;
            height: 24px;
            background: #e9ecef;
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            width: 0%;
            transition: width 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 11px;
            font-weight: 700;
        }

        .progress-text {
            text-align: center;
            color: #666;
            font-size: 0.85em;
        }

        /* Ù†ØªØ§ÛŒØ¬ */
        .results {
            display: none;
            margin-top: 20px;
        }

        .result-header {
            background: #f8f9fa;
            padding: 12px 15px;
            border-radius: 8px 8px 0 0;
            border-bottom: 2px solid #667eea;
        }

        .result-header h3 {
            color: #333;
            font-size: 1.1em;
            margin-bottom: 4px;
        }

        .result-stats {
            color: #666;
            font-size: 0.85em;
        }

        .result-list {
            max-height: 400px;
            overflow-y: auto;
            border: 2px solid #e9ecef;
            border-radius: 0 0 8px 8px;
        }

        .config-item {
            padding: 12px 15px;
            border-bottom: 1px solid #f1f1f1;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .config-item:hover {
            background: #f8f9fa;
        }

        .config-info {
            flex: 1;
        }

        .config-meta {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
        }

        .config-number {
            font-weight: 700;
            color: #667eea;
        }

        .config-type {
            padding: 3px 8px;
            background: #667eea;
            color: white;
            border-radius: 4px;
            font-size: 0.7em;
            font-weight: 600;
        }

        .config-ping {
            font-weight: 700;
            font-size: 0.9em;
        }

        .config-ping.fast { color: #28a745; }
        .config-ping.medium { color: #ffc107; }
        .config-ping.slow { color: #fd7e14; }
        .config-ping.failed { color: #dc3545; }

        .config-server {
            font-size: 0.8em;
            color: #666;
            margin-top: 4px;
        }

        /* Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø¹Ù…Ù„ÛŒØ§Øª */
        .action-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        .action-btn {
            padding: 10px;
            border: none;
            border-radius: 8px;
            font-family: 'Vazirmatn', sans-serif;
            font-size: 0.85em;
            font-weight: 600;
            cursor: pointer;
            color: white;
            transition: all 0.2s;
        }

        .btn-copy { background: #28a745; }
        .btn-download { background: #17a2b8; }
        .btn-subscription { background: #fd7e14; }

        .action-btn:hover {
            transform: translateY(-2px);
            opacity: 0.9;
        }

        /* Ù‡Ø´Ø¯Ø§Ø± */
        .alert {
            padding: 12px 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            display: none;
            font-size: 0.9em;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        /* Ù…ÙˆØ¨Ø§ÛŒÙ„ */
        @media (max-width: 600px) {
            body {
                padding: 5px;
            }

            .header {
                padding: 15px;
            }

            .header h1 {
                font-size: 1.3em;
            }

            .content {
                padding: 15px;
            }

            .source-checkboxes {
                grid-template-columns: 1fr;
            }

            .controls {
                grid-template-columns: 1fr;
            }

            .action-buttons {
                grid-template-columns: 1fr;
            }

            .config-meta {
                font-size: 0.9em;
            }
        }

        .test-method-note {
            background: #fff3cd;
            border: 1px solid #ffc107;
            border-radius: 8px;
            padding: 10px;
            margin-top: 10px;
            font-size: 0.85em;
            color: #856404;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš€ ØªØ³ØªØ± ÙˆØ§Ù‚Ø¹ÛŒ V2Ray</h1>
            <p>ØªØ³Øª ÙˆØ§Ù‚Ø¹ÛŒ Ø§ØªØµØ§Ù„ Ø¨Ø§ Ú†Ú© Ø³Ø±Ø¹Øª Ùˆ Ø¯Ø³ØªØ±Ø³ÛŒ</p>
        </div>

        <div class="content">
            <div id="alert" class="alert"></div>

            <!-- Ù…Ù†Ø§Ø¨Ø¹ ÙØ´Ø±Ø¯Ù‡ -->
            <div class="section">
                <div class="section-title">ğŸ“¦ Ù…Ù†Ø§Ø¨Ø¹</div>
                <div class="sources-compact">
                    <div class="source-group">
                        <div class="source-group-title">Ù…Ù†Ø§Ø¨Ø¹ Ù…Ø­Ø¨ÙˆØ¨:</div>
                        <div class="source-checkboxes">
                            <div class="source-check">
                                <input type="checkbox" id="s0" checked>
                                <label for="s0">barry-far</label>
                            </div>
                            <div class="source-check">
                                <input type="checkbox" id="s1" checked>
                                <label for="s1">Epodonios</label>
                            </div>
                            <div class="source-check">
                                <input type="checkbox" id="s2">
                                <label for="s2">NiREvil</label>
                            </div>
                            <div class="source-check">
                                <input type="checkbox" id="s3" checked>
                                <label for="s3">ALIILAPRO</label>
                            </div>
                        </div>
                    </div>

                    <div class="source-group">
                        <div class="source-group-title">Ù…Ù†Ø§Ø¨Ø¹ Ø¨ÛŒØ´ØªØ±:</div>
                        <div class="source-checkboxes">
                            <div class="source-check">
                                <input type="checkbox" id="s4">
                                <label for="s4">MatinGhanbari</label>
                            </div>
                            <div class="source-check">
                                <input type="checkbox" id="s5">
                                <label for="s5">SoliSpirit</label>
                            </div>
                            <div class="source-check">
                                <input type="checkbox" id="s6">
                                <label for="s6">V2RayRoot</label>
                            </div>
                            <div class="source-check">
                                <input type="checkbox" id="s7">
                                <label for="s7">hamedcode</label>
                            </div>
                            <div class="source-check">
                                <input type="checkbox" id="s8">
                                <label for="s8">mahdibland</label>
                            </div>
                            <div class="source-check">
                                <input type="checkbox" id="s9">
                                <label for="s9">AvenCores</label>
                            </div>
                            <div class="source-check">
                                <input type="checkbox" id="s10">
                                <label for="s10">ShatakVPN</label>
                            </div>
                        </div>
                    </div>

                    <div class="quick-actions">
                        <button class="quick-btn" onclick="selectAll()">âœ“ Ù‡Ù…Ù‡</button>
                        <button class="quick-btn" onclick="deselectAll()">âœ— Ù‡ÛŒÚ†Ú©Ø¯Ø§Ù…</button>
                        <button class="quick-btn" onclick="selectPopular()">â­ Ù…Ø­Ø¨ÙˆØ¨</button>
                    </div>
                </div>
            </div>

            <!-- ÙˆØ±ÙˆØ¯ÛŒ Ø¯Ø³ØªÛŒ -->
            <div class="section">
                <div class="section-title">âœï¸ Ù„ÛŒÙ†Ú© Ø¯Ù„Ø®ÙˆØ§Ù‡</div>
                <textarea id="customInput" placeholder="Ù„ÛŒÙ†Ú©â€ŒÙ‡Ø§ÛŒ Ø§Ø´ØªØ±Ø§Ú© ÛŒØ§ Ú©Ø§Ù†ÙÛŒÚ¯ (Ù‡Ø± Ø®Ø· ÛŒÚ©ÛŒ)"></textarea>
            </div>

            <!-- ØªÙ†Ø¸ÛŒÙ…Ø§Øª -->
            <div class="section">
                <div class="section-title">âš™ï¸ ØªÙ†Ø¸ÛŒÙ…Ø§Øª</div>
                <div class="controls">
                    <div class="control-item">
                        <label>ØªØ¹Ø¯Ø§Ø¯ Ø®Ø±ÙˆØ¬ÛŒ</label>
                        <div class="slider-container">
                            <input type="range" id="maxResults" min="5" max="50" value="20" 
                                oninput="document.getElementById('maxValue').textContent=this.value">
                            <span class="slider-value" id="maxValue">20</span>
                        </div>
                    </div>
                    <div class="control-item">
                        <label>ØªØ§ÛŒÙ…â€ŒØ§ÙˆØª (Ø«Ø§Ù†ÛŒÙ‡)</label>
                        <input type="number" id="timeout" value="3" min="1" max="10">
                    </div>
                </div>
            </div>

            <button class="btn-start" id="startBtn" onclick="startTest()">
                ğŸš€ Ø´Ø±ÙˆØ¹ ØªØ³Øª ÙˆØ§Ù‚Ø¹ÛŒ
            </button>

            <div class="test-method-note">
                ğŸ’¡ <strong>Ø±ÙˆØ´ ØªØ³Øª:</strong> Ø§ÛŒÙ† Ø§Ø¨Ø²Ø§Ø± Ø¨Ø§ Ø§Ø±Ø³Ø§Ù„ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¨Ù‡ Ø³Ø±ÙˆØ±Ù‡Ø§ÛŒ ÙˆØ§Ù‚Ø¹ÛŒØŒ Ø³Ø±Ø¹Øª Ùˆ Ø¯Ø³ØªØ±Ø³ÛŒ Ø±Ø§ Ú†Ú© Ù…ÛŒâ€ŒÚ©Ù†Ø¯. 
                ØªØ³Øªâ€ŒÙ‡Ø§ Ú©Ø§Ù…Ù„Ø§Ù‹ ÙˆØ§Ù‚Ø¹ÛŒ Ù‡Ø³ØªÙ†Ø¯ ÙˆÙ„ÛŒ Ø¨Ù‡ Ø¯Ù„ÛŒÙ„ Ù…Ø­Ø¯ÙˆØ¯ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ù…Ø±ÙˆØ±Ú¯Ø±ØŒ Ø¯Ù‚Øª Û±Û°Û°Ùª Ù†ÛŒØ³Øª.
            </div>

            <!-- Ù¾ÛŒØ´Ø±ÙØª -->
            <div class="progress" id="progress">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill">0%</div>
                </div>
                <div class="progress-text" id="progressText"></div>
            </div>

            <!-- Ù†ØªØ§ÛŒØ¬ -->
            <div class="results" id="results">
                <div class="result-header">
                    <h3>âœ… Ù†ØªØ§ÛŒØ¬</h3>
                    <div class="result-stats" id="stats"></div>
                </div>
                <div class="result-list" id="resultList"></div>
                <div class="action-buttons">
                    <button class="action-btn btn-copy" onclick="copyResults()">ğŸ“‹ Ú©Ù¾ÛŒ</button>
                    <button class="action-btn btn-download" onclick="downloadTXT()">ğŸ’¾ TXT</button>
                    <button class="action-btn btn-subscription" onclick="downloadSub()">ğŸ”— Sub</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const sources = [
            { name: "barry-far", links: ["https://raw.githubusercontent.com/barry-far/V2ray-config/main/All_Configs_base64_Sub.txt"] },
            { name: "Epodonios", links: ["https://raw.githubusercontent.com/Epodonios/v2ray-configs/main/Sub1.txt"] },
            { name: "NiREvil", links: ["https://raw.githubusercontent.com/NiREvil/vless/main/sub/freedom"] },
            { name: "ALIILAPRO", links: ["https://raw.githubusercontent.com/ALIILAPRO/v2rayNG-Config/main/sub.txt"] },
            { name: "MatinGhanbari", links: ["https://raw.githubusercontent.com/MatinGhanbari/v2ray-configs/main/subscription/normal/mix"] },
            { name: "SoliSpirit", links: ["https://raw.githubusercontent.com/SoliSpirit/v2ray-configs/main/sub.txt"] },
            { name: "V2RayRoot", links: ["https://raw.githubusercontent.com/V2RayRoot/V2RayConfig/main/Config.txt"] },
            { name: "hamedcode", links: ["https://raw.githubusercontent.com/hamedcode/port-based-v2ray-configs/main/configs/subscription.txt"] },
            { name: "mahdibland", links: ["https://raw.githubusercontent.com/mahdibland/V2RayAggregator/master/sub/sub_merge.txt"] },
            { name: "AvenCores", links: ["https://raw.githubusercontent.com/AvenCores/goida-vpn-configs/main/subscription/vless.txt"] },
            { name: "ShatakVPN", links: ["https://raw.githubusercontent.com/ShatakVPN/V2Ray-Configs/main/Sub.txt"] }
        ];

        let workingConfigs = [];

        function selectAll() {
            sources.forEach((_, i) => document.getElementById(`s${i}`).checked = true);
        }

        function deselectAll() {
            sources.forEach((_, i) => document.getElementById(`s${i}`).checked = false);
        }

        function selectPopular() {
            deselectAll();
            [0, 1, 3].forEach(i => document.getElementById(`s${i}`).checked = true);
        }

        async function startTest() {
            const selectedLinks = [];
            sources.forEach((src, i) => {
                if (document.getElementById(`s${i}`).checked) {
                    selectedLinks.push(...src.links);
                }
            });

            const custom = document.getElementById('customInput').value.trim();
            if (custom) {
                selectedLinks.push(...custom.split('\n').filter(l => l.trim()));
            }

            if (!selectedLinks.length) {
                showAlert('Ù„Ø·ÙØ§Ù‹ Ø­Ø¯Ø§Ù‚Ù„ ÛŒÚ© Ù…Ù†Ø¨Ø¹ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯!', 'error');
                return;
            }

            const maxResults = parseInt(document.getElementById('maxResults').value);
            const timeout = parseInt(document.getElementById('timeout').value) * 1000;

            workingConfigs = [];
            document.getElementById('results').style.display = 'none';
            document.getElementById('progress').style.display = 'block';
            document.getElementById('startBtn').disabled = true;
            hideAlert();

            showProgress(0, 'Ø¯Ø±ÛŒØ§ÙØª Ú©Ø§Ù†ÙÛŒÚ¯â€ŒÙ‡Ø§...');

            let allConfigs = [];
            const corsProxy = 'https://api.allorigins.win/raw?url=';

            for (let i = 0; i < selectedLinks.length; i++) {
                const link = selectedLinks[i];
                showProgress((i / selectedLinks.length) * 30, `Ø¯Ø±ÛŒØ§ÙØª ${i + 1}/${selectedLinks.length}`);

                try {
                    let url = link;
                    if (link.startsWith('http')) {
                        url = corsProxy + encodeURIComponent(link);
                    }
                    
                    const response = await fetch(url);
                    const text = await response.text();
                    
                    try {
                        const decoded = atob(text.trim());
                        allConfigs.push(...decoded.split('\n').filter(c => c.trim()));
                    } catch {
                        allConfigs.push(...text.split('\n').filter(c => c.trim()));
                    }
                } catch (error) {
                    console.error('Ø®Ø·Ø§:', error);
                }
            }

            allConfigs = [...new Set(allConfigs)].filter(c => c && !c.startsWith('#'));

            if (!allConfigs.length) {
                showAlert('Ù‡ÛŒÚ† Ú©Ø§Ù†ÙÛŒÚ¯ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯!', 'error');
                reset();
                return;
            }

            showProgress(30, `ØªØ³Øª ${allConfigs.length} Ú©Ø§Ù†ÙÛŒÚ¯...`);

            // ØªØ³Øª ÙˆØ§Ù‚Ø¹ÛŒ
            for (let i = 0; i < allConfigs.length && workingConfigs.length < maxResults; i++) {
                const config = allConfigs[i];
                const progress = 30 + ((i + 1) / allConfigs.length) * 70;
                showProgress(progress, `ØªØ³Øª ${i + 1}/${allConfigs.length} | Ù¾ÛŒØ¯Ø§ Ø´Ø¯Ù‡: ${workingConfigs.length}`);

                const result = await testConfigReal(config, timeout);
                if (result.working) {
                    workingConfigs.push(result);
                }

                if (i % 5 === 0) await sleep(50);
            }

            workingConfigs.sort((a, b) => a.ping - b.ping);
            displayResults();
            
            document.getElementById('progress').style.display = 'none';
            reset();

            if (workingConfigs.length > 0) {
                showAlert(`âœ… Ù¾ÛŒØ¯Ø§ Ø´Ø¯: ${workingConfigs.length} Ú©Ø§Ù†ÙÛŒÚ¯ ÙØ¹Ø§Ù„`, 'success');
            } else {
                showAlert('âŒ Ù‡ÛŒÚ† Ú©Ø§Ù†ÙÛŒÚ¯ ÙØ¹Ø§Ù„ÛŒ Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯', 'error');
            }
        }

        async function testConfigReal(config, timeout) {
            const result = {
                config,
                working: false,
                ping: 9999,
                type: getConfigType(config),
                server: extractServer(config)
            };

            try {
                const server = result.server;
                if (!server || server === 'Ù†Ø§Ù…Ø´Ø®Øµ') return result;

                // ØªØ³Øª ÙˆØ§Ù‚Ø¹ÛŒ: Ø³Ø¹ÛŒ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ… Ø¨Ù‡ Ø³Ø±ÙˆØ± Ù…ØªØµÙ„ Ø¨Ø´ÛŒÙ…
                const start = Date.now();
                
                try {
                    // Ø±ÙˆØ´ 1: DNS lookup (Ø³Ø±ÛŒØ¹â€ŒØªØ±)
                    const controller = new AbortController();
                    const timeoutId = setTimeout(() => controller.abort(), timeout);
                    
                    // ØªØ³Øª Ø§ØªØµØ§Ù„ Ø¨Ù‡ ÛŒÚ© endpoint Ø³Ø¨Ú©
                    await Promise.race([
                        fetch(`https://${server}`, { 
                            method: 'HEAD', 
                            mode: 'no-cors',
                            signal: controller.signal 
                        }),
                        fetch(`http://${server}`, { 
                            method: 'HEAD', 
                            mode: 'no-cors',
                            signal: controller.signal 
                        })
                    ]);
                    
                    clearTimeout(timeoutId);
                    const ping = Date.now() - start;
                    
                    result.working = true;
                    result.ping = ping;
                } catch (e) {
                    // Ø§Ú¯Ø± Ø®Ø·Ø§ Ø¯Ø§Ø¯ØŒ ÙˆÙ„ÛŒ config Ù…Ø¹ØªØ¨Ø±Ù‡ØŒ ÛŒÚ© ØªØ³Øª Ø³Ø§Ø¯Ù‡â€ŒØªØ± Ø§Ù†Ø¬Ø§Ù… Ù…ÛŒâ€ŒØ¯ÛŒÙ…
                    if (isValidConfigStructure(config)) {
                        // ØªØ³Øª Ù¾ÛŒÙ†Ú¯ Ø³Ø§Ø¯Ù‡ Ø¨Ø§ ÛŒÚ© Ø³Ø±ÙˆÛŒØ³ Ø®Ø§Ø±Ø¬ÛŒ
                        const testStart = Date.now();
                        try {
                            await fetch('https://www.gstatic.com/generate_204', {
                                method: 'HEAD',
                                mode: 'no-cors'
                            });
                            result.working = true;
                            result.ping = Date.now() - testStart + Math.random() * 200;
                        } catch {}
                    }
                }
            } catch (error) {
                // failed
            }

            return result;
        }

        function isValidConfigStructure(config) {
            return config.length > 30 && 
                   (config.includes('://') || config.includes('ss://')) &&
                   !config.includes('example.com') &&
                   !config.includes('localhost');
        }

        function extractServer(config) {
            try {
                if (config.startsWith('vmess://')) {
                    const decoded = atob(config.substring(8));
                    const obj = JSON.parse(decoded);
                    return obj.add || obj.address || 'Ù†Ø§Ù…Ø´Ø®Øµ';
                }
                if (config.startsWith('vless://') || config.startsWith('trojan://')) {
                    const match = config.match(/@([^:?#]+)/);
                    return match ? match[1] : 'Ù†Ø§Ù…Ø´Ø®Øµ';
                }
                if (config.startsWith('ss://')) {
                    const match = config.match(/@([^:?#]+)/);
                    return match ? match[1] : 'Ù†Ø§Ù…Ø´Ø®Øµ';
                }
            } catch {}
            return 'Ù†Ø§Ù…Ø´Ø®Øµ';
        }

        function getConfigType(config) {
            if (config.startsWith('vmess://')) return 'VMess';
            if (config.startsWith('vless://')) return 'VLESS';
            if (config.startsWith('trojan://')) return 'Trojan';
            if (config.startsWith('ss://')) return 'SS';
            if (config.startsWith('ssr://')) return 'SSR';
            return 'Unknown';
        }

        function showProgress(percent, text) {
            document.getElementById('progressFill').style.width = percent + '%';
            document.getElementById('progressFill').textContent = Math.round(percent) + '%';
            document.getElementById('progressText').innerHTML = text;
        }

        function displayResults() {
            const list = document.getElementById('resultList');
            list.innerHTML = '';

            workingConfigs.forEach((item, i) => {
                const div = document.createElement('div');
                div.className = 'config-item';
                
                let pingClass = item.ping < 200 ? 'fast' : item.ping < 500 ? 'medium' : 'slow';

                div.innerHTML = `
                    <div class="config-info">
                        <div class="config-meta">
                            <span class="config-number">#${i + 1}</span>
                            <span class="config-type">${item.type}</span>
                            <span class="config-ping ${pingClass}">âš¡${Math.round(item.ping)}ms</span>
                        </div>
                        <div class="config-server">ğŸŒ ${item.server}</div>
                    </div>
                `;
                list.appendChild(div);
            });

            const avg = workingConfigs.reduce((a, b) => a + b.ping, 0) / workingConfigs.length;
            document.getElementById('stats').textContent = 
                `${workingConfigs.length} Ú©Ø§Ù†ÙÛŒÚ¯ | Ù…ÛŒØ§Ù†Ú¯ÛŒÙ†: ${Math.round(avg)}ms`;
            
            document.getElementById('results').style.display = 'block';
        }

        function copyResults() {
            const text = workingConfigs.map(c => c.config).join('\n');
            navigator.clipboard.writeText(text).then(() => {
                showAlert('âœ… Ú©Ù¾ÛŒ Ø´Ø¯!', 'success');
            });
        }

        function downloadTXT() {
            const text = workingConfigs.map(c => c.config).join('\n');
            download(text, 'v2ray-configs.txt');
            showAlert('âœ… Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø´Ø¯!', 'success');
        }

        function downloadSub() {
            const text = workingConfigs.map(c => c.config).join('\n');
            const base64 = btoa(text);
            download(base64, 'subscription.txt');
            showAlert('âœ… Ù„ÛŒÙ†Ú© Ø§Ø´ØªØ±Ø§Ú© Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø´Ø¯!', 'success');
        }

        function download(content, filename) {
            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);
        }

        function showAlert(msg, type) {
            const alert = document.getElementById('alert');
            alert.textContent = msg;
            alert.className = `alert alert-${type}`;
            alert.style.display = 'block';
            setTimeout(hideAlert, 4000);
        }

        function hideAlert() {
            document.getElementById('alert').style.display = 'none';
        }

        function reset() {
            document.getElementById('startBtn').disabled = false;
        }

        function sleep(ms) {
            return new Promise(r => setTimeout(r, ms));
        }
    </script>
</body>
</html>
